// @ts-nocheck
export class CurrencyManager{constructor(e){this.actor=e,this.initializeCurrency()}initializeCurrency(){this.actor.system.currency||(this.actor.system.currency={}),this.actor.system.currency.pp=this.actor.system.currency.pp||0,this.actor.system.currency.gp=this.actor.system.currency.gp||0,this.actor.system.currency.sp=this.actor.system.currency.sp||0,this.actor.system.currency.cp=this.actor.system.currency.cp||0}getTotalGoldValue(){const e=this.actor.system.currency;return 1e3*e.pp+e.gp+.1*e.sp+.01*e.cp}addCurrency(e,t="gp"){return this.actor.system.currency[t]?(this.actor.system.currency[t]+=e,this.consolidateCurrency(),!0):(console.warn(`Unknown currency type: ${t}`),!1)}removeCurrency(e,t="gp"){const r=this.actor.system.currency[t]||0;return r<e?(console.warn(`Not enough ${t}. Have ${r}, need ${e}`),!1):(this.actor.system.currency[t]-=e,!0)}consolidateCurrency(){const e=this.actor.system.currency;e.cp>=10&&(e.sp+=Math.floor(e.cp/10),e.cp=e.cp%10),e.sp>=10&&(e.gp+=Math.floor(e.sp/10),e.sp=e.sp%10),e.gp>=1e3&&(e.pp+=Math.floor(e.gp/1e3),e.gp=e.gp%1e3)}getCurrencyString(){const e=this.actor.system.currency,t=[];return e.pp>0&&t.push(`${e.pp} pp`),e.gp>0&&t.push(`${e.gp} gp`),e.sp>0&&t.push(`${e.sp} sp`),e.cp>0&&t.push(`${e.cp} cp`),t.length>0?t.join(", "):"No currency"}getCurrencyWeight(){return((this.actor.system.currency.pp||0)+(this.actor.system.currency.gp||0)+(this.actor.system.currency.sp||0)+(this.actor.system.currency.cp||0))/50}}export class EncumbranceCalculator{constructor(e){this.actor=e}getCarryingCapacity(){const e=this.actor.system.abilities.str.value;return{light:Math.floor(10*e/3),medium:Math.floor(20*e/3),heavy:10*e}}getTotalWeight(){let e=0;this.actor.items.forEach(t=>{const r=t.system.properties?.weight||0,c=t.quantity||1;e+=r*c});const t=new CurrencyManager(this.actor);return e+=t.getCurrencyWeight(),e}getEncumbranceLevel(){const e=this.getCarryingCapacity(),t=this.getTotalWeight();return t<=e.light?{level:"light",name:"Light Encumbrance",penalty:0}:t<=e.medium?{level:"medium",name:"Medium Encumbrance",penalty:-3,speedReduction:.75}:t<=e.heavy?{level:"heavy",name:"Heavy Encumbrance",penalty:-6,speedReduction:.5}:{level:"over",name:"Over Carrying Capacity",cannotMove:!0}}getSpeedModifier(){return this.getEncumbranceLevel().speedReduction||1}getEncumbrancePenalties(){const e=this.getEncumbranceLevel();return e.penalty?{acPenalty:0,skillPenalty:e.penalty,speedReduction:e.speedReduction||1}:{acPenalty:0,skillPenalty:0,speedReduction:1}}}export class WealthManager{constructor(e){this.actor=e}static getWealthByLevel(e){const t={1:100,2:500,3:1e3,4:2500,5:5e3,6:8500,7:13e3,8:19e3,9:27e3,10:36e3,11:49e3,12:66e3,13:89e3,14:12e4,15:16e4,16:22e4,17:29e4,18:38e4,19:49e4,20:63e4};return t[e]||t[20]}getRecommendedWealth(){const e=this.actor.system.details.level.value||1;return WealthManager.getWealthByLevel(e)}getTotalWealth(){let e=0;const t=new CurrencyManager(this.actor);return e+=t.getTotalGoldValue(),this.actor.items.forEach(t=>{const r=t.system.properties?.cost||0,c=t.quantity||1;let s=1;t.system.properties?.enhancement&&(s*=2**t.system.properties.enhancement),t.system.properties?.masterwork&&(s*=1.3),e+=r*c*s}),e}meetsWealthExpectation(){const e=this.getRecommendedWealth(),t=this.getTotalWealth();return{expected:e,actual:t,ratio:t/e,isSufficient:t>=.9*e}}}